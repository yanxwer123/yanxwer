#set($layout="layout/emptylayout.vm")
#set($menuTitle="自用油卡管理")
<div id="query"   title="查询条件" collapsible="true" class="easyui-panel search panel-body panel-body-noheader" style="border:0px;padding: 10px; width: 100%;" icon="icon-search">
    <table  width="500px">
        <tr>
            <th width="250px">自用油卡卡号：<input id="cardNo" type="text"   style="width: 200px" value="">
                <a id="searchExchange" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'" style="width: 60px" onclick="initData()">查询</a>
            </th>
        </tr>
    </table>
</div>
<div id="toolbar">
    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" onclick="addSelf()" plain="true">新增</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" onclick="dellSelf()" plain="true">删除</a>
</div>
<div id="result" class="easyui-panel"  >
    <table id="tt" class="easyui-datagrid">
    </table>
</div>
<div id="winSelf" class="easyui-window" title="新增" closed="true" style="width:460px;height:200px;"
     data-options="modal:true">

    <form id="loginForm" action="/web/sysmanage/addSelf" method="post" style="padding:5px 5px 5px 5px;">
        <table>
            <tr>
                <td style="padding-top:10px">自用油卡号</td>
                <td style="padding-top:10px"><input class="easyui-textbox" type="text" id="addcardNo" name="cardNo" data-options="required:true,precision:2" /></td>
            </tr>
            <tr>
                <td style="padding-top:10px">创建人</td>
                <td style="padding-top:10px"><input class="easyui-textbox" type="text" id="addcreateUser" name="createUser" data-options="required:true,precision:2" value="$session.getAttribute("realname")" /></td>
            </tr>
        </table>
        <div style="padding:5px;text-align:center;">
            <a  class="easyui-linkbutton" onclick="submitForm()">添加</a>
        </div>
    </form>
</div>
<script>
    var cols=[[
        {field:'cardNo',title:'自用油卡号',width:5,align:'center'},
       /* {field: 'createDate', title: '创建时间', width: 5, align: 'center',formatter:function(value,row,index){
            var time=formatDatebox(row.createDate);
            return time;
        }},
        {field:'createUser',title:'创建人',width:5,align:'center'},
        {field: 'updateDate', title: '更新时间', width: 5, align: 'center',formatter:function(value,row,index){
            var time1=formatDatebox(row.updateDate);
            return time1;
        }},
        {field:'updateUser',title:'更新人',width:5,align:'center'},*/
        {field:'status',title:'状态',width:5,align:'center'}
    ]]
    var cardNo;
    var paras;
    $(function(){
        var heigth=$(window).height()-130;
        $("#result").height(heigth);
        initData();
    });
    function initData(){
        initText();
        BindDataGridAjax('tt','自用油卡管理','/web/sysmanage/getSelfOillList',cols,paras,'true',10,[10,20,30]);
    }
    function initText(){
        cardNo=$("#cardNo").val();//自用油卡号
        paras = {"cardNo": cardNo};
    }
    function addSelf () {
        $('#winSelf').window('open');

    }

    //新增记录
    function submitForm() {
        //卡号校验，19位纯数字
       /* cardNo=$("#addcardNo").val();//自用油卡号
        if(){

        }*/

        $(loginForm).form('submit', {
            url : '/web/sysmanage/addSelf',
            dataType : 'text',
            success : function(result) {
                if (result>0) {
                    $.messager.alert("提示", "恭喜您，信息添加成功！", "info");
                    $("#addcardNo").textbox("setValue","");
                    $('#winSelf').window('close');
                    $('#tt').datagrid("reload",{ });
                } else {
                    $.messager.alert("提示", "添加失败，请重新操作！", "info");
                }
            }
        });
    }
     function dellSelf() {
         var delrow = $('#tt').datagrid('getSelected');
         if (delrow == null) {
             $.messager.alert("提示", "请选择要删除的行！", "info");
             return;
         } else {
             $.messager.confirm('提示', '是否删除选中数据?', function (r) {
                 if (!r) {
                     return;
                 }
                 var cardNo=delrow.cardNo;
                 //提交
                 $.ajax({
                     type: "POST",
                     url: "/web/sysmanage/delSelf?cardNo="+cardNo,
                     data: cardNo,
                     success: function (result) {
                         if (result > 0) {
                             $('#tt').datagrid('clearSelections');
                             $.messager.alert("提示", "恭喜您，信息删除成功！", "info");
                             $('#tt').datagrid('reload');
                         } else {
                             $.messager.alert("提示", "删除失败，请重新操作！", "info");
                             return;
                         }
                     }
                 });
             });
         }
     }

    function formatDatebox(value) {
        if (value == null || value == '') {
            return '';
        }
        var dt;
        if (value instanceof Date) {
            dt = value;
        } else {
            dt = new Date(value);
        }
        return dt.format("yyyy-MM-dd hh:mm:ss"); //扩展的Date的format方法(上述插件实现)
    }
</script>