#set($layout="layout/emptylayout.vm")
#set($menuTitle="油站配送")
<div id="query" title="查询条件" collapsible="true" class="easyui-panel search panel-body panel-body-noheader" style="border:0px;padding: 10px; width: 100%;" icon="icon-search">
    <table width="800">
        <tr>
            <th width="100px">
                选择油站：
            </th>
            <th width="150px">
                <input id="cc" name="cc"  class="easyui-combobox textbox" type="text"  style="width:150px" data-options="prompt:'--请选择--'"></input>
            </th>
            <th width="150px">
                <input id="aa" name="aa"  class="easyui-combobox textbox" type="text" style="width:150px" data-options="prompt:'--请选择--'"></input>
            </th>
            <th width="150px">
                <input id="ss" name="ss"  class="easyui-combobox textbox" type="text" style="width:150px" data-options="prompt:'--请选择--'"></input>
            </th>
            <th width="100px" align="right"> 油品：</th>
            <th width="150px" align="left">
                <select id="selectOil"  style=" width: 150px">
                </select>
            </th>

        <tr>
            <th>配送建议：</th>
            <th>
                <select id="selectPSJY" class="easyui-combobox" style=" width: 150px">
                    <option value="">全部</option>
                    <option value="1">紧急</option>
                    <option value="2">一般</option>
                </select>
            </th>
            <th align="right">
                测量时间：
            </th>
            <th colspan="3">
                <input id="dateStartinput" type="text" class="easyui-datebox" required="required"/>至
                <input id="dateEndinput" type="text" class="easyui-datebox" required="required"/>
            </th>


        </tr>
        <tr>
            <th></th>
            <th>
                <a id="btnSelect" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'" onclick="initData();">查询</a>
                <a id="btnExport" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'" onclick="ExportExl();">导出</a>
            </th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
    </table>
</div>
<div id="result">
    <table id="tt" fit="true" style="height: 500px;">
    </table>
</div>
<script>

    var cols=[[
        {field:'STATION_NAME',title:'油站名称',width:100,align:'center'},
        {field:'OilName',title:'油品',width:100,align:'center'},
        {field:'MesasureTime',title:'测量时间',width:120,align:'center'},
        {field:'NowVolume',title:'当前体积',width:100,align:'center'},
        {field:'CanSaleVolume',title:'可销售体积',width:100,align:'center'},
        {field:'DayAverageSales',title:'日常销售量',width:100,align:'center'},
        {field:'HourAverageSales',title:'平均每小时销售量',width:100,align:'center'},
        {field:'PredictHours',title:'预计销售时间',width:100,align:'center'},
        {field:'YJSSTS',title:'预计销售天数',width:100,align:'center'},
        {field:'PSYJ',title:'配送建议',width:100,align:'center'}
    ]];
    var  oilno;//油品编号
    var psjy; //配送建议
    var startTime;
    var  endTime;
    var oucode;
    var paras;
    $(function(){
        initOilCombox();
        Loadcas("cc","aa","ss");
        var heigth=$(window).height()-160;
        $("#result").height(heigth);
        var myDate = new Date();
        var MyTime=new Date();
        //var time=MyTime.getFullYear() + "-" + (MyTime.getMonth()) + "-" + MyTime.getDate();
        $("#dateStartinput").datebox('setValue','<%=myDate.toLocaleDateString()%>');
        $("#dateEndinput").datebox('setValue','<%=myDate.toLocaleDateString()%>');
        initData();
    });

    function inittext(){
        oilno=$('#selectOil').combobox('getValue');
        psjy=$('#selectPSJY').combobox('getValue');; //配送建议
        startTime=$('#dateStartinput').datebox('getValue');
        endTime=$('#dateEndinput').datebox('getValue');
        var end = new Date();
        var date = end.getDate();
        date = date + 1;
        end.setDate(date);
        var over=end.toLocaleDateString();


        endTime=over;
        oucode="";
        var ss=$('#ss').combobox('getValue');
        var aa=$('#aa').combobox('getValue');
        var cc=$('#cc').combobox('getValue');
        if(cc!="")
        {
            oucode=cc;
        }
        if(aa!="")
        {
            oucode=aa;
        }
        if(ss!="")
        {
            oucode=ss;
        }
        paras={"OilNo":oilno,"StartAlarmTime":startTime,"EndAlarmTime":endTime,"PSJY":psjy,"oucode":oucode};

    }
    function initData() {
        inittext();
        BindDataGridAjax('tt','加油配送建议','/web/alarminfo/selectJySaleOutPageList',cols,paras,'true',10,[10,20,30]);
    }


    function ExportExl() {
        inittext();
        var filename=encodeURI(encodeURI("油站配送建议"));
        window.open("/web/alarminfo/excelSaleOut?OilNo="+oilno+"&StartAlarmTime="+startTime+"&EndAlarmTime="+endTime+"&PSJY="+psjy+"&FileName="+filename+"&oucode="+oucode);
    }

    function initOilCombox() {
        $('#selectOil').combobox({
            url:'/web/oiltypeinfo/selectOilType',
            valueField:'OilNo',
            textField:'OilName'
        });

    }

</script>

